function getLinkPhoto(t,e){return baseurl+t+"/photo-"+e}function getUrlPhoto(t,e,a,i,r){return"https://"+getCDNSubdomain(i)+".wklcdn.com/"+t+"/"+e+"/"+a+"/"+i+r+".jpg"}function fetchTrailsFromWikiloc(){gblSpas=data.spas;var t=[],e=0;$.each(data.spas,function(a,i){t.length<19&&(t.push('<li id="act-li-'+e+'"><a href="'+baseurl+"/"+i.url+'" title="'+i.url_title+'" data-id="'+i.id+'" class="pictogram activity-'+i.act+'">'+i.url_title+"</a></li>"),e++)}),t.length<20&&t.push('<li id="more-activities"><a style="background-image:none;text-indent:0" href="'+$("#activities-link").attr("href")+'">&hellip;</a></li>'),$("ul.trail-nav").html(t.join("")),previewTrail()}function previewTrail(){var t=gblSpas,e=t.length,a=spaView,i=t[a];$("#trail-activity").text(i.act_name);var r=i.name;r.length>40?($("#trail-name").addClass("long"),r.length>63&&(r=r.substr(0,60)+"&hellip;")):$("#trail-name").removeClass("long"),$("#trail-name").html('<a id="trail-name-link" href="'+baseurl+i.prettyURL+'">'+r+"</a>"),$("#trail-meta").html("<em>"+Math.ceil(i.length)+" "+i.length_unit+"</em>. "+i.near);var o=i.author,n=i.authorId;$(".trail-user-link").attr("href","/wikiloc/user.do?id="+n),o.length>20&&(o=o.substr(0,17)+"&hellip;"),$("#trail-user-name").html(o);var l="image_"+Math.floor(n/3e4),s="https://"+getCDNSubdomain(n)+".wklcdn.com/"+l+"/"+n+"/photo_tn.jpg";avatarLoad($("#trail-user-photo img")[0],s),$("#imagemap").css("background-image","url(https://sc.wklcdn.com/homemap/"+i.id+".jpg)"),$("#imagemap").click(function(t){t.preventDefault(),window.location=$("#trail-name-link").attr("href")}),$("ul.trail-nav li").removeClass("selected"),$("#act-li-"+a).addClass("selected");for(var u=[],c=0,m=0,p=i.photos.length;m<p&&c<4;m++){var h=getLinkPhoto(i.prettyURL,i.photos[m]),d=getUrlPhoto(l,n,i.id,i.photos[m],".120x90");u.push('<a href="'+h+'"><img src="'+d+'" /></a>'),c++}if(c<4&&void 0!=i.extPhotos)for(var m=0,p=i.extPhotos.length;m<p&&c<4;m++){var h=getLinkPhoto(i.prettyURL,i.extPhotos[m]),d=i.extPhotos[m];u.push('<a href="'+h+'"><img width="120px" height="90px" src="'+decodeURIComponent(d)+'" /></a>'),c++}$("#trail-photos").html(u.join("")),spaView<e-1?(spaView++,i=t[spaView]):spaView=0,"play"==glbSlideStat&&(clearTimeout(slideshowTimeout),slideshowTimeout=setTimeout(previewTrail,PERIOD))}function sh_pause(){clearTimeout(slideshowTimeout),glbSlideStat="pause"}function sh_play(){clearTimeout(slideshowTimeout),glbSlideStat="play",slideshowTimeout=setTimeout(previewTrail,PERIOD)}function nextSpa(){previewTrail()}function previousSpa(){var t=gblSpas,e=spaView,a=t[e];spaView>1&&(spaView-=2,a=t[spaView],previewTrail())}function avatarLoad(t,e){var a=new Image;a.src=e,a.onload=function(){t.src=a.src},a.onerror=function(){t.src="/wikiloc/images/noface.png"}}function incrementCounter(){currentCount++,updateTrailCount(currentCount)}function updateTrailCount(t){for(var e=t.toString().split("").reverse(),a=[],i=0,r=0;r<e.length;r++)i++,4==i&&(a.push(numSeparator),i=1),a.push(e[r]);var o=a.reverse().join("");$("#trail-count").text(o),counter.goToNumber(t)}var PERIOD=8e3,slideshowTimeout=null,resizeTimedOut=null,glbSlideStat="play",gblSpas=null,spaView=0,trail_show=null;if($(function(){fetchTrailsFromWikiloc();var t=$("#search-trails-form button").text();$("#search-trails-form button").after('<a href="#" class="btn btn-success" id="search-submit">'+t+"</a>").hide(),$("#search-submit").click(function(t){t.preventDefault(),$("#search-trails-form").submit()}),$("#search-trails-input").width(220-$("#search-trails-form button").width()),$('<div id="act-tool" class="activity-tooltip"></div>').appendTo("#trail-slider"),$(".trail-nav li").mouseover(function(t){var e=$(this).position(),a=$(this).find("a");a.attr("title","");var i=a.text();0==a.find("span").length&&(i=translate("txtActivities")),$("#act-tool").css({top:e.top-30,left:e.left}).text(i).show()}).mouseout(function(t){$("#act-tool").hide()}),$("#previous-but").click(function(){previousSpa()}),$("#next-but").click(function(){nextSpa()})}),$("#map_wrapper").hover(sh_pause,sh_play),"undefined"==typeof console)var console={log:function(){}};var rawNumber=$("#trail-count").text(),incEvery=30,counter;if(rawNumber.indexOf(",")>0)var numSeparator=",",currentCount=parseInt(rawNumber.replace(/\,/g,""),10),numberImage="https://sc.wklcdn.com/wikiloc/images/jodometer-numbers.png?v=2";else if(rawNumber.indexOf(".")>0)var numSeparator=".",currentCount=parseInt(rawNumber.replace(/\./g,""),10),numberImage="https://sc.wklcdn.com/wikiloc/images/jodometer-numbers-dot.png?v=2";else var numSeparator=" ",currentCount=parseInt(rawNumber.replace(/\s/g,""),10),numberImage="https://sc.wklcdn.com/wikiloc/images/jodometer-numbers-space.png?v=2";$(function(){counter=$(".counter1").jOdometer({increment:1,counterStart:"00000000",numbersImage:numberImage,heightNumber:65,widthNumber:50,spaceNumbers:5,formatNumber:!0,delayTime:1}),updateTrailCount(currentCount)});